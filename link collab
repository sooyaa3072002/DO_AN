https://colab.research.google.com/drive/18BfyRvu63dAGdt76FNvJlBaGUv4cFN_k?usp=sharing  (lá»‹ch cá»‘ Ä‘á»‹nh)


import numpy as np
import matplotlib.pyplot as plt

# THÃ”NG Sá» Há»† THá»NG
capacity_battery = 19.2  # kWh
max_charge_power = 9.6  # kW
max_discharge_power = 19.2  # kW
soc_min = 0.2 * capacity_battery
soc_max = 0.8 * capacity_battery
efficiency_charge = 0.9
efficiency_discharge = 0.85
initial_soc = 0.5 * capacity_battery
delta_t = 1  # giá»

# GIÃ BÃN VÃ€ MUA ÄIá»†N
sell_price = 671  # VNÄ/kWh
max_grid_buy = 15
max_grid_sell = 10

# GiÃ¡ mua Ä‘iá»‡n theo khung giá» (cáº¥p dÆ°á»›i 6kV) - cáº­p nháº­t theo báº£ng báº¡n gá»­i
def get_buy_price_by_time(hour):
    if 22 <= hour or hour < 4:
        return 1830  # Tháº¥p Ä‘iá»ƒm
    elif (9.5 <= hour < 11.5) or (17 <= hour < 20):
        return 5174  # Cao Ä‘iá»ƒm
    else:
        return 3007  # BÃ¬nh thÆ°á»ng

# Dá»® LIá»†U
hours = np.arange(0, 24)
pv_power = np.array([0, 0, 0, 0, 0, 0, 0.66, 1.32, 2.42, 3.30, 3.96, 4.40,
                     4.62, 4.40, 3.96, 3.08, 1.98, 0.88, 0, 0, 0, 0, 0, 0])
load_power = np.array([0.61, 0.61, 0.61, 0.61, 0.61, 0.61, 1.90, 2.15, 0.30,
                       0.30, 0.28, 3.13, 0.685, 0.68, 0.38, 0.38, 0.38, 1.52,
                       3.92, 3.92, 2.02, 2.02, 0.82, 0.67])

# BIáº¾N LÆ¯U TRáº NG THÃI
soc = initial_soc
battery_state, buy_energy, sell_energy = [], [], []
charge_energy, discharge_energy = [], []
buy_cost_per_hour, sell_revenue_per_hour = [], []

def enforce_constraints(value, min_value, max_value):
    return max(min_value, min(value, max_value))

# Láº¬P Lá»ŠCH Náº P/Xáº¢
for i in range(len(hours)):
    charge_amount = 0
    discharge_amount = 0
    grid_buy = 0
    grid_sell = 0

    # KHUNG GIá»œ Sáº C (11h-15h)
    if 11 <= hours[i] < 15:
        charge_amount = min(max_charge_power, soc_max - soc, pv_power[i] * efficiency_charge)
        charge_amount = enforce_constraints(charge_amount, 0, max_charge_power)
        soc += charge_amount
        surplus = pv_power[i] - charge_amount / efficiency_charge
        grid_sell = enforce_constraints(surplus, 0, max_grid_sell)

    # KHUNG GIá»œ Xáº¢ (18h-6h)
    elif hours[i] >= 18 or hours[i] < 6:
        discharge_amount = min(max_discharge_power, soc - soc_min, load_power[i] / efficiency_discharge)
        discharge_amount = enforce_constraints(discharge_amount, 0, max_discharge_power)
        soc -= discharge_amount
        deficit = load_power[i] - discharge_amount * efficiency_discharge
        grid_buy = enforce_constraints(deficit, 0, max_grid_buy)

    # KHÃ”NG Sáº C/Xáº¢ Äá»’NG THá»œI
    if discharge_amount > 0:
        charge_amount = 0
    if charge_amount > 0:
        discharge_amount = 0

    soc = enforce_constraints(soc, soc_min, soc_max)

    # GIÃ ÄIá»†N THEO KHUNG GIá»œ
    buy_price_hourly = get_buy_price_by_time(hours[i])

    # LÆ¯U Káº¾T QUáº¢
    charge_energy.append(charge_amount)
    discharge_energy.append(discharge_amount)
    battery_state.append(soc)
    buy_energy.append(grid_buy)
    sell_energy.append(grid_sell)
    buy_cost_per_hour.append(grid_buy * buy_price_hourly)
    sell_revenue_per_hour.append(grid_sell * sell_price)

# TÃNH Tá»”NG
cumulative_buy_cost = np.cumsum(buy_cost_per_hour)
cumulative_sell_revenue = np.cumsum(sell_revenue_per_hour)

# BIá»‚U Äá»’
plt.figure(figsize=(10, 6))
plt.plot(hours, pv_power, 'b-o', label="CÃ´ng suáº¥t PV (kW)")
plt.plot(hours, load_power, color='orange', marker='o', label="Phá»¥ táº£i (kW)")
plt.plot(hours, buy_energy, 'g-o', label="Mua tá»« lÆ°á»›i (kW)")
plt.plot(hours, sell_energy, 'r-o', label="BÃ¡n lÃªn lÆ°á»›i (kW)")
plt.xlabel("Giá» trong ngÃ y")
plt.ylabel("CÃ´ng suáº¥t (kW)")
plt.title("CÃ´ng suáº¥t PV, Phá»¥ táº£i, Mua/BÃ¡n theo giá»")
plt.xticks(hours)
plt.legend()
plt.grid(True, linestyle='--', alpha=0.7)
plt.tight_layout()
plt.show()

plt.figure(figsize=(10, 6))
plt.plot(hours, battery_state, color='purple', marker='o', label="SOC cá»§a pin (kWh)")
plt.xlabel("Giá» trong ngÃ y")
plt.ylabel("Dung lÆ°á»£ng pin (kWh)")
plt.title("Tráº¡ng thÃ¡i SOC cá»§a pin theo thá»i gian")
plt.xticks(hours)
plt.legend()
plt.grid(True, linestyle='--', alpha=0.7)
plt.tight_layout()
plt.show()

plt.figure(figsize=(10, 6))
plt.plot(hours, cumulative_buy_cost, 'g-o', label="Chi phÃ­ mua tÃ­ch lÅ©y (VNÄ)")
plt.plot(hours, cumulative_sell_revenue, 'r-o', label="Doanh thu bÃ¡n tÃ­ch lÅ©y (VNÄ)")
plt.xlabel("Giá» trong ngÃ y")
plt.ylabel("VNÄ")
plt.title("Chi phÃ­ mua vÃ  doanh thu bÃ¡n Ä‘iá»‡n tÃ­ch lÅ©y")
plt.xticks(hours)
plt.legend()
plt.grid(True, linestyle='--', alpha=0.7)
plt.tight_layout()
plt.show()

# IN Báº¢NG Láº¬P Lá»ŠCH
print("\n===== ğŸ“‹ Chi tiáº¿t láº­p lá»‹ch mua/bÃ¡n vÃ  sáº¡c/xáº£ Ä‘iá»‡n theo tá»«ng giá» =====")
print("Giá» |  Mua lÆ°á»›i (kW) | Chi phÃ­ (VNÄ) | BÃ¡n lÆ°á»›i (kW) | Doanh thu (VNÄ) |  Sáº¡c (kW) |  Xáº£ (kW) |  SOC (kWh)")
print("-" * 100)

for t in hours:
    print(f"{t:>2}  | {buy_energy[t]:>13.2f} | {buy_cost_per_hour[t]:>13,.0f} | "
          f"{sell_energy[t]:>13.2f} | {sell_revenue_per_hour[t]:>15,.0f} | "
          f"{charge_energy[t]:>9.2f} | {discharge_energy[t]:>8.2f} | {battery_state[t]:>10.2f}")

# Tá»”NG Káº¾T
total_buy_energy = sum(buy_energy)
total_sell_energy = sum(sell_energy)
total_buy_cost = sum(buy_cost_per_hour)
total_sell_revenue = sum(sell_revenue_per_hour)
net_cost = total_buy_cost - total_sell_revenue

print("\n===== ğŸ“Š Tá»•ng káº¿t trong ngÃ y =====")
print(f"ğŸ”¹ Tá»•ng Ä‘iá»‡n mua tá»« lÆ°á»›i:       {total_buy_energy:.2f} kWh")
print(f"ğŸ”¹ Tá»•ng Ä‘iá»‡n bÃ¡n lÃªn lÆ°á»›i:      {total_sell_energy:.2f} kWh")
print(f"ğŸ”¹ Tá»•ng chi phÃ­ mua Ä‘iá»‡n:       {total_buy_cost:,.0f} VNÄ")
print(f"ğŸ”¹ Tá»•ng doanh thu bÃ¡n Ä‘iá»‡n:     {total_sell_revenue:,.0f} VNÄ")
print(f"ğŸ”¹ ğŸ“‰ Tá»•ng chi phÃ­ thá»±c táº¿:       {net_cost:,.0f} VNÄ")

